<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Chat + Player Completo</title>
  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    body{background:#121212;color:#EEE;font-family:Arial,sans-serif;display:flex;flex-direction:column;height:100vh;}
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0;}
    #menuSetup,#namePrompt,#waitingApproval{padding:1rem;display:flex;flex-direction:column;gap:.5rem;align-items:center;text-align:center;}
    #mainUI{display:none;flex:1;flex-direction:row;max-width:1200px;margin:0 auto;position:relative;}
    @media(min-width:1600px){#mainUI{max-width:900px;margin:2rem auto;border:1px solid #444;border-radius:10px;box-shadow:0 0 20px #0008;}}
    @media(max-width:768px){#mainUI{flex-direction:column!important;width:100%!important;height:100vh!important;padding:.5rem!important;} #playerArea,#chatArea{width:100%!important;} #chatArea{height:150px!important;border-left:none!important;border-top:1px solid #333!important;margin-top:.5rem!important;}}
    #playerArea{flex:2;background:#222;display:flex;flex-direction:column;align-items:center;padding:1rem;position:relative;}
    video{width:100%;max-width:800px;border-radius:6px;background:#000;position:relative;z-index:1;}
    #controls{margin:1rem;display:flex;gap:.5rem;flex-wrap:wrap;position:relative;z-index:1;}
    .btn{background:#ff4500;border:none;color:#FFF;padding:.5rem 1rem;border-radius:5px;cursor:pointer;z-index:1;}
    #chatArea{flex:1;display:flex;flex-direction:column;background:#1f1f1f;border-left:1px solid #333;position:relative;}
    #chatLog{flex:1;overflow-y:auto;padding:.5rem;}
    #chatInputArea{padding:.5rem;display:flex;gap:.5rem;}
    #chatInput{flex:1;padding:.5rem;border-radius:4px;border:none;background:#222;color:#EEE;}
    #fileMenuModal{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.75);display:none;justify-content:center;align-items:center;z-index:9999;}
    #fileMenuContent{background:#333;padding:1.5rem;border-radius:8px;min-width:320px;display:flex;flex-direction:column;gap:.75rem;}
    #fileMenuContent button{background:#444;color:#fff;padding:.75rem;border:none;border-radius:5px;cursor:pointer;font-size:1rem;}
    #participantList{display:none;position:absolute;top:10px;right:10px;background:#2c2c2c;padding:1rem;border-radius:6px;z-index:10;max-height:400px;overflow-y:auto;}
    .participantItem{display:flex;align-items:center;justify-content:space-between;padding:.3rem 0;border-bottom:1px solid #444;}
    .participantItem:hover{background:#333;}
    .participantName{flex:1;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
    .admin-controls{display:flex;gap:.3rem;}
    .admin-controls button{background:#444;border:none;color:#EEE;padding:.2rem .5rem;border-radius:4px;cursor:pointer;font-size:.8rem;}
    .admin-controls .danger{background:#a00;}
    .modal-menu{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#222;border:1px solid #555;padding:1rem;border-radius:8px;display:none;z-index:10000;}
    .modal-menu.visible{display:block;}
    .modal-menu h3{margin-bottom:1rem;}
    .modal-menu .option{margin:.3rem 0;padding:.5rem;background:#444;color:#FFF;border-radius:4px;text-align:center;cursor:pointer;}
    .modal-menu .option.danger{background:#a00;}
  </style>
</head>
<body>
  <div id="controls">
    <button id="chooseMediaBtn" class="btn">Escolher Arquivo/Link/Tela</button>
    <button id="showPlaylistBtn" class="btn">ðŸ“ƒ Playlist</button>
    <button id="showParticipantsBtn" class="btn">ðŸ‘¥ Participantes</button>
  </div>

  <div id="playlistWindow" class="modal-menu">
    <h3>Playlist Atual</h3>
    <ul id="playlistItems" style="max-height:200px;overflow:auto;padding-left:1rem;text-align:left;"></ul>
    <div style="margin-top:1rem;text-align:center;">
      <button onclick="document.getElementById('playlistWindow').classList.remove('visible')" class="btn">Fechar</button>
    </div>
  </div>

  <div id="participantList"></div>

  <script>
    const playlist = [];
    const playlistWindow = document.getElementById('playlistWindow');
    const playlistItems = document.getElementById('playlistItems');
    const showPlaylistBtn = document.getElementById('showPlaylistBtn');
    const showParticipantsBtn = document.getElementById('showParticipantsBtn');
    const participantList = document.getElementById('participantList');

    let isAdmin = true;
    const connList = {
      exemplo1: { name: 'Luana', ua: 'Mozilla/5.0' },
      exemplo2: { name: 'Jonathan', ua: 'Mozilla/5.0' }
    };

    function addToPlaylist(url, name) {
      const type = url.includes('.mp3') ? 'Ãudio' : 'VÃ­deo';
      playlist.push({ url, addedBy: name, type });
      updatePlaylistDisplay();
    }

    function updatePlaylistDisplay() {
      playlistItems.innerHTML = '';
      playlist.forEach((item, index) => {
        const li = document.createElement('li');
        li.textContent = `${index === 0 ? '[Tocando agora] ' : ''}${item.type}: ${item.url.split('/').pop()} (por ${item.addedBy})`;
        playlistItems.appendChild(li);
      });
    }

    showPlaylistBtn.onclick = () => {
      if (/Mobi|Android/i.test(navigator.userAgent)) {
        window.open('about:blank', '_blank').document.write('<h1 style="padding:1rem;font-family:sans-serif;">Playlist</h1><ul>' + playlist.map(item => `<li>${item.type}: ${item.url.split('/').pop()} (por ${item.addedBy})</li>`).join('') + '</ul>');
      } else {
        playlistWindow.classList.add('visible');
      }
    };

    showParticipantsBtn.onclick = () => {
      participantList.innerHTML = '';
      Object.entries(connList).forEach(([id, data]) => {
        const div = document.createElement('div');
        div.className = 'participantItem';
        div.title = data.ua || '';
        const name = document.createElement('span');
        name.className = 'participantName';
        name.textContent = data.name || id;
        div.appendChild(name);

        if (isAdmin) {
          const adminControls = document.createElement('div');
          adminControls.className = 'admin-controls';
          ['silence','kick','ban'].forEach(action => {
            const btn = document.createElement('button');
            btn.textContent = action;
            if (action !== 'silence') btn.classList.add('danger');
            btn.onclick = () => alert(`${action} em ${data.name}`);
            adminControls.appendChild(btn);
          });
          div.appendChild(adminControls);
        }

        participantList.appendChild(div);
      });
      participantList.style.display = participantList.style.display === 'block' ? 'none' : 'block';
    };
  </script>
</body>
</html>
